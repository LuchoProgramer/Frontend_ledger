(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,15788,e=>{"use strict";let t=(0,e.i(75254).default)("truck",[["path",{d:"M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2",key:"wrbu53"}],["path",{d:"M15 18H9",key:"1lyqi6"}],["path",{d:"M19 18h2a1 1 0 0 0 1-1v-3.65a1 1 0 0 0-.22-.624l-3.48-4.35A1 1 0 0 0 17.52 8H14",key:"lysw3i"}],["circle",{cx:"17",cy:"18",r:"2",key:"332jqn"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}]]);e.s(["Truck",()=>t],15788)},18566,(e,t,s)=>{t.exports=e.r(76562)},75254,e=>{"use strict";var t=e.i(71645);let s=e=>{let t=e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,s)=>s?s.toUpperCase():t.toLowerCase());return t.charAt(0).toUpperCase()+t.slice(1)},a=(...e)=>e.filter((e,t,s)=>!!e&&""!==e.trim()&&s.indexOf(e)===t).join(" ").trim();var r={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let l=(0,t.forwardRef)(({color:e="currentColor",size:s=24,strokeWidth:l=2,absoluteStrokeWidth:i,className:n="",children:o,iconNode:c,...d},x)=>(0,t.createElement)("svg",{ref:x,...r,width:s,height:s,stroke:e,strokeWidth:i?24*Number(l)/Number(s):l,className:a("lucide",n),...!o&&!(e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0})(d)&&{"aria-hidden":"true"},...d},[...c.map(([e,s])=>(0,t.createElement)(e,s)),...Array.isArray(o)?o:[o]])),i=(e,r)=>{let i=(0,t.forwardRef)(({className:i,...n},o)=>(0,t.createElement)(l,{ref:o,iconNode:r,className:a(`lucide-${s(e).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,`lucide-${e}`,i),...n}));return i.displayName=s(e),i};e.s(["default",()=>i],75254)},7233,e=>{"use strict";let t=(0,e.i(75254).default)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);e.s(["Plus",()=>t],7233)},83164,e=>{"use strict";var t=e.i(18050),s=e.i(71645),a=e.i(83639),r=e.i(9165);function l(){let[e,l]=(0,s.useState)([]),[i,n]=(0,s.useState)(!1),[o,c]=(0,s.useState)(""),[d,x]=(0,s.useState)(""),[m,g]=(0,s.useState)(""),[h,u]=(0,s.useState)(1),[p,b]=(0,s.useState)(1),y=(0,r.getApiClient)(),f=async()=>{n(!0);try{let e=await y.getHistorialVentas({page:h,start_date:o,end_date:d,search:m});l(e.results),e.count&&b(Math.ceil(e.count/20))}catch(e){console.error("Error cargando facturas",e)}finally{n(!1)}};(0,s.useEffect)(()=>{let e=setTimeout(()=>{f()},500);return()=>clearTimeout(e)},[h,o,d,m]),(0,s.useEffect)(()=>{if(!e.some(e=>"PPR"===e.estado_sri))return;let t=setInterval(()=>{console.log("Auto-refreshing facturas en procesamiento..."),f()},1e4);return()=>clearInterval(t)},[e]);let j=e=>{let s={AUT:{bg:"bg-green-100",text:"text-green-800",label:"AUTORIZADO"},PPR:{bg:"bg-yellow-100",text:"text-yellow-800",label:"PROCESANDO"},NAT:{bg:"bg-red-100",text:"text-red-800",label:"NO AUTORIZADO"},DEV:{bg:"bg-orange-100",text:"text-orange-800",label:"DEVUELTA"}}[e]||{bg:"bg-gray-100",text:"text-gray-800",label:"PENDIENTE"};return(0,t.jsx)("span",{className:`px-2.5 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${s.bg} ${s.text}`,children:s.label})};return(0,t.jsx)(a.default,{children:(0,t.jsxs)("div",{className:"max-w-7xl mx-auto p-4 sm:p-6 lg:p-8",children:[(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4 mb-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-900",children:"Historial de Ventas"}),e.some(e=>"PPR"===e.estado_sri)&&(0,t.jsxs)("p",{className:"text-sm text-yellow-600 mt-1 flex items-center gap-2",children:[(0,t.jsx)("span",{className:"animate-pulse",children:"â—"}),"Auto-actualizando facturas en procesamiento..."]})]}),(0,t.jsx)("button",{onClick:()=>f(),className:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors shadow-sm",children:"ðŸ”„ Actualizar"})]}),(0,t.jsx)("div",{className:"bg-white p-4 sm:p-6 rounded-xl shadow-sm mb-6 border border-gray-100",children:(0,t.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Desde"}),(0,t.jsx)("input",{type:"date",value:o,onChange:e=>{c(e.target.value),u(1)},className:"w-full p-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Hasta"}),(0,t.jsx)("input",{type:"date",value:d,onChange:e=>{x(e.target.value),u(1)},className:"w-full p-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"})]}),(0,t.jsxs)("div",{className:"sm:col-span-2",children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Buscar"}),(0,t.jsx)("input",{type:"text",placeholder:"Cliente o nÃºmero de factura...",value:m,onChange:e=>{g(e.target.value),u(1)},className:"w-full p-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"})]})]})}),(0,t.jsx)("div",{className:"hidden lg:block bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden",children:(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,t.jsx)("thead",{className:"bg-gray-50",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Fecha"}),(0,t.jsx)("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Factura"}),(0,t.jsx)("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Cliente"}),(0,t.jsx)("th",{className:"px-4 py-3 text-right text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Total"}),(0,t.jsx)("th",{className:"px-4 py-3 text-center text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Estado"}),(0,t.jsx)("th",{className:"px-4 py-3 text-center text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Acciones"})]})}),(0,t.jsxs)("tbody",{className:"bg-white divide-y divide-gray-200",children:[i&&(0,t.jsx)("tr",{children:(0,t.jsx)("td",{colSpan:6,className:"p-8 text-center text-gray-500",children:(0,t.jsxs)("div",{className:"flex justify-center items-center",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"}),(0,t.jsx)("span",{className:"ml-3",children:"Cargando..."})]})})}),!i&&0===e.length&&(0,t.jsx)("tr",{children:(0,t.jsx)("td",{colSpan:6,className:"p-8 text-center text-gray-500",children:"No hay facturas registradas"})}),e.map(e=>(0,t.jsxs)("tr",{className:"hover:bg-gray-50 transition-colors",children:[(0,t.jsxs)("td",{className:"px-4 py-4 whitespace-nowrap",children:[(0,t.jsx)("div",{className:"text-sm text-gray-900",children:new Date(e.fecha_emision).toLocaleDateString("es-EC")}),(0,t.jsx)("div",{className:"text-xs text-gray-500",children:new Date(e.fecha_emision).toLocaleTimeString("es-EC",{hour:"2-digit",minute:"2-digit"})})]}),(0,t.jsx)("td",{className:"px-4 py-4",children:(0,t.jsxs)("div",{className:"flex flex-col max-w-xs",children:[(0,t.jsx)("span",{className:"text-sm font-medium text-gray-900",children:e.numero_autorizacion}),e.clave_acceso&&(0,t.jsxs)("span",{className:"text-xs text-gray-400 font-mono truncate cursor-help",title:e.clave_acceso,children:[e.clave_acceso.substring(0,15),"..."]})]})}),(0,t.jsx)("td",{className:"px-4 py-4",children:(0,t.jsx)("div",{className:"text-sm text-gray-900 max-w-xs truncate",title:e.cliente_nombre,children:e.cliente_nombre})}),(0,t.jsx)("td",{className:"px-4 py-4 whitespace-nowrap text-right",children:(0,t.jsxs)("span",{className:"text-sm font-bold text-gray-900",children:["$",Number(e.total_con_impuestos).toFixed(2)]})}),(0,t.jsx)("td",{className:"px-4 py-4 whitespace-nowrap text-center",children:j(e.estado_sri||"PENDIENTE")}),(0,t.jsx)("td",{className:"px-4 py-4 whitespace-nowrap text-center",children:(0,t.jsxs)("div",{className:"flex justify-center gap-2",children:[(0,t.jsxs)("button",{onClick:async()=>{try{await y.descargarFacturaPDF(e.id,e.numero_autorizacion)}catch(e){alert("Error descargando PDF")}},className:"px-3 py-1.5 text-xs font-medium text-indigo-600 hover:text-indigo-900 hover:bg-indigo-50 rounded-lg transition-colors flex items-center gap-1",title:"Descargar RIDE (PDF)",children:[(0,t.jsx)("span",{children:"ðŸ“„"})," PDF"]}),"AUT"!==e.estado_sri&&(0,t.jsxs)("button",{onClick:async()=>{if(console.log("BotÃ³n SRI presionado para ID:",e.id),confirm("Â¿Enviar factura al SRI?"))try{console.log("Llamando a apiClient.enviarSRI..."),await y.enviarSRI(e.id),console.log("Respuesta recibida de enviarSRI"),alert("Enviado. El estado se actualizarÃ¡ en breve."),f()}catch(e){console.error("Error enviando SRI:",e),alert("Error enviando al SRI: "+(e.message||e.toString()))}},className:"px-3 py-1.5 text-xs font-medium text-green-600 hover:text-green-900 hover:bg-green-50 rounded-lg transition-colors flex items-center gap-1",title:"Enviar al SRI",children:[(0,t.jsx)("span",{children:"ðŸ“¤"})," SRI"]}),(0,t.jsx)("button",{className:"px-3 py-1.5 text-xs font-medium text-gray-600 hover:text-gray-900 hover:bg-gray-50 rounded-lg transition-colors",title:"Descargar XML",children:"ðŸ“‹ XML"})]})})]},e.id))]})]})})}),(0,t.jsxs)("div",{className:"lg:hidden space-y-4",children:[i&&(0,t.jsx)("div",{className:"bg-white p-8 rounded-xl shadow-sm text-center",children:(0,t.jsxs)("div",{className:"flex justify-center items-center",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"}),(0,t.jsx)("span",{className:"ml-3 text-gray-500",children:"Cargando..."})]})}),!i&&0===e.length&&(0,t.jsx)("div",{className:"bg-white p-8 rounded-xl shadow-sm text-center text-gray-500",children:"No hay facturas registradas"}),e.map(e=>(0,t.jsxs)("div",{className:"bg-white p-4 rounded-xl shadow-sm border border-gray-100",children:[(0,t.jsxs)("div",{className:"flex justify-between items-start mb-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.numero_autorizacion}),(0,t.jsx)("div",{className:"text-xs text-gray-500 mt-1",children:new Date(e.fecha_emision).toLocaleString("es-EC")})]}),j(e.estado_sri||"PENDIENTE")]}),(0,t.jsxs)("div",{className:"space-y-2 mb-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-xs text-gray-500",children:"Cliente:"}),(0,t.jsx)("div",{className:"text-sm text-gray-900",children:e.cliente_nombre})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-xs text-gray-500",children:"Total:"}),(0,t.jsxs)("div",{className:"text-lg font-bold text-gray-900",children:["$",Number(e.total_con_impuestos).toFixed(2)]})]})]}),(0,t.jsxs)("div",{className:"flex gap-2 pt-3 border-t border-gray-100",children:[(0,t.jsxs)("button",{onClick:async()=>{try{await y.descargarFacturaPDF(e.id,e.numero_autorizacion)}catch(e){alert("Error descargando PDF")}},className:"flex-1 px-3 py-2 text-sm font-medium text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors flex items-center justify-center gap-2",children:[(0,t.jsx)("span",{children:"ðŸ“„"})," PDF"]}),"AUT"!==e.estado_sri&&(0,t.jsxs)("button",{onClick:async()=>{if(console.log("BotÃ³n SRI MÃ³vil presionado para ID:",e.id),confirm("Â¿Enviar factura al SRI?"))try{console.log("Llamando a apiClient.enviarSRI..."),await y.enviarSRI(e.id),alert("Enviado. El estado se actualizarÃ¡ en breve."),f()}catch(e){console.error("Error enviando SRI:",e),alert("Error enviando al SRI: "+(e.message||e.toString()))}},className:"flex-1 px-3 py-2 text-sm font-medium text-green-600 hover:bg-green-50 rounded-lg transition-colors flex items-center justify-center gap-2",children:[(0,t.jsx)("span",{children:"ðŸ“¤"})," SRI"]}),(0,t.jsx)("button",{className:"flex-1 px-3 py-2 text-sm font-medium text-gray-600 hover:bg-gray-50 rounded-lg transition-colors",children:"ðŸ“‹ XML"})]})]},e.id))]}),(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-4 mt-6",children:[(0,t.jsxs)("span",{className:"text-sm text-gray-600",children:["PÃ¡gina ",(0,t.jsx)("span",{className:"font-semibold",children:h})," de ",(0,t.jsx)("span",{className:"font-semibold",children:p})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("button",{disabled:h<=1,onClick:()=>u(e=>e-1),className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"â† Anterior"}),(0,t.jsx)("button",{disabled:h>=p,onClick:()=>u(e=>e+1),className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Siguiente â†’"})]})]})]})})}e.s(["default",()=>l])}]);