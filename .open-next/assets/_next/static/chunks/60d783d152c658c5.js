(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,18566,(e,s,a)=>{s.exports=e.r(76562)},89880,e=>{"use strict";var s=e.i(18050),a=e.i(71645),r=e.i(18566),t=e.i(9165),i=e.i(57951);function l(){let e=(0,r.useRouter)(),l=Number((0,r.useParams)().id),{isAdmin:d}=(0,i.useAuth)(),[o,n]=(0,a.useState)(!1),[c,u]=(0,a.useState)(!0),[m,x]=(0,a.useState)(""),[g,p]=(0,a.useState)(!1),[h,b]=(0,a.useState)(null),[j,y]=(0,a.useState)({email:"",first_name:"",last_name:"",password:"",grupos:[],sucursales:[],is_active:!0}),[f,N]=(0,a.useState)([]),[v,w]=(0,a.useState)([]);(0,a.useEffect)(()=>{d||e.push("/")},[d,e]),(0,a.useEffect)(()=>{let e=async()=>{try{let e=(0,t.getApiClient)(),[s,a,r]=await Promise.all([e.getUsuario(l),e.getGrupos(),e.getSucursales()]);s.success&&s.usuario?(b(s.usuario),y({email:s.usuario.email||"",first_name:s.usuario.first_name||"",last_name:s.usuario.last_name||"",password:"",grupos:s.usuario.grupos.map(e=>e.id),sucursales:s.usuario.sucursales.map(e=>e.id),is_active:s.usuario.is_active})):x("Usuario no encontrado"),a.success&&N(a.grupos),r.success&&w(r.sucursales)}catch(e){x(e.message||"Error cargando datos")}finally{u(!1)}};d&&l&&e()},[d,l]);let _=async s=>{if(s.preventDefault(),x(""),p(!1),n(!0),j.password&&j.password.length<8){x("La contraseña debe tener al menos 8 caracteres"),n(!1);return}try{let s=(0,t.getApiClient)(),a={email:j.email,first_name:j.first_name,last_name:j.last_name,grupos:j.grupos,sucursales:j.sucursales,is_active:j.is_active};j.password&&(a.password=j.password);let r=await s.actualizarUsuario(l,a);r.success?(p(!0),setTimeout(()=>{e.push("/usuarios")},1500)):x(r.error||"Error actualizando usuario")}catch(e){x(e.message||"Error actualizando usuario")}finally{n(!1)}};return d?(0,s.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,s.jsx)("div",{className:"bg-white shadow-sm border-b",children:(0,s.jsx)("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,s.jsx)("button",{onClick:()=>e.push("/usuarios"),className:"text-gray-600 hover:text-gray-900",children:"← Volver"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Editar Usuario"}),h&&(0,s.jsxs)("p",{className:"text-sm text-gray-500 mt-1",children:["@",h.username]})]})]})})}),(0,s.jsxs)("main",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[m&&(0,s.jsx)("div",{className:"mb-6 bg-red-50 border border-red-200 rounded-lg p-4",children:(0,s.jsx)("p",{className:"text-red-700",children:m})}),g&&(0,s.jsx)("div",{className:"mb-6 bg-green-50 border border-green-200 rounded-lg p-4",children:(0,s.jsx)("p",{className:"text-green-700",children:"✅ Usuario actualizado exitosamente. Redirigiendo..."})}),c?(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border p-12 text-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto"}),(0,s.jsx)("p",{className:"text-gray-500 mt-4",children:"Cargando datos..."})]}):h?(0,s.jsxs)("form",{onSubmit:_,className:"bg-white rounded-lg shadow-sm border overflow-hidden",children:[(0,s.jsxs)("div",{className:"p-6 space-y-6",children:[(0,s.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("h3",{className:"font-semibold text-blue-900",children:[h.first_name," ",h.last_name]}),(0,s.jsxs)("p",{className:"text-sm text-blue-700",children:["@",h.username]})]}),(0,s.jsxs)("div",{className:"text-right text-sm text-blue-700",children:[(0,s.jsxs)("p",{children:["Registrado: ",new Date(h.date_joined).toLocaleDateString("es-EC")]}),h.last_login&&(0,s.jsxs)("p",{children:["Último acceso: ",new Date(h.last_login).toLocaleDateString("es-EC")]})]})]})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Información Básica"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,s.jsxs)("div",{className:"md:col-span-2",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Correo Electrónico"}),(0,s.jsx)("input",{type:"email",value:j.email,onChange:e=>y({...j,email:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",placeholder:"usuario@ejemplo.com"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nombre"}),(0,s.jsx)("input",{type:"text",value:j.first_name,onChange:e=>y({...j,first_name:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",placeholder:"Juan"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Apellido"}),(0,s.jsx)("input",{type:"text",value:j.last_name,onChange:e=>y({...j,last_name:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",placeholder:"Pérez"})]}),(0,s.jsxs)("div",{className:"md:col-span-2",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nueva Contraseña (opcional)"}),(0,s.jsx)("input",{type:"password",value:j.password,onChange:e=>y({...j,password:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",placeholder:"Dejar vacío para mantener la actual",minLength:8}),(0,s.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Dejar vacío si no desea cambiar la contraseña. Mínimo 8 caracteres si se cambia."})]})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Grupos y Permisos"}),(0,s.jsx)("div",{className:"space-y-2",children:0===f.length?(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"No hay grupos disponibles"}):f.map(e=>(0,s.jsxs)("label",{className:"flex items-center space-x-3 p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer",children:[(0,s.jsx)("input",{type:"checkbox",checked:j.grupos.includes(e.id),onChange:()=>{var s;return s=e.id,void y(e=>({...e,grupos:e.grupos.includes(s)?e.grupos.filter(e=>e!==s):[...e.grupos,s]}))},className:"w-4 h-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"font-medium text-gray-900",children:e.name}),"Administrador"===e.name&&(0,s.jsx)("p",{className:"text-xs text-gray-500",children:"Acceso completo al sistema"}),"Usuarios"===e.name&&(0,s.jsx)("p",{className:"text-xs text-gray-500",children:"Acceso al POS y ventas"})]})]},e.id))})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Sucursales Asignadas"}),(0,s.jsx)("div",{className:"space-y-2",children:0===v.length?(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"No hay sucursales disponibles"}):v.map(e=>(0,s.jsxs)("label",{className:"flex items-center space-x-3 p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer",children:[(0,s.jsx)("input",{type:"checkbox",checked:j.sucursales.includes(e.id),onChange:()=>{var s;return s=e.id,void y(e=>({...e,sucursales:e.sucursales.includes(s)?e.sucursales.filter(e=>e!==s):[...e.sucursales,s]}))},className:"w-4 h-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)("span",{className:"font-medium text-gray-900",children:e.nombre}),e.es_matriz&&(0,s.jsx)("span",{className:"text-xs bg-blue-100 text-blue-800 px-2 py-0.5 rounded",children:"Matriz"})]}),e.codigo_establecimiento&&(0,s.jsxs)("p",{className:"text-xs text-gray-500",children:["Cód: ",e.codigo_establecimiento]})]})]},e.id))})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Estado"}),(0,s.jsxs)("label",{className:"flex items-center space-x-3 p-3 border border-gray-200 rounded-lg cursor-pointer",children:[(0,s.jsx)("input",{type:"checkbox",checked:j.is_active,onChange:e=>y({...j,is_active:e.target.checked}),className:"w-4 h-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"font-medium text-gray-900",children:"Usuario Activo"}),(0,s.jsx)("p",{className:"text-xs text-gray-500",children:j.is_active?"El usuario puede acceder al sistema":"El usuario no podrá iniciar sesión"})]})]})]})]}),(0,s.jsxs)("div",{className:"bg-gray-50 px-6 py-4 flex justify-end space-x-4",children:[(0,s.jsx)("button",{type:"button",onClick:()=>e.push("/usuarios"),className:"px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-100 font-medium",disabled:o,children:"Cancelar"}),(0,s.jsx)("button",{type:"submit",disabled:o,className:"px-6 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg font-medium disabled:bg-gray-400 disabled:cursor-not-allowed",children:o?"Guardando...":"Guardar Cambios"})]})]}):(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border p-12 text-center",children:[(0,s.jsx)("p",{className:"text-red-600 text-lg",children:"Usuario no encontrado"}),(0,s.jsx)("button",{onClick:()=>e.push("/usuarios"),className:"mt-4 text-indigo-600 hover:text-indigo-700 font-medium",children:"Volver a la lista"})]})]})]}):null}e.s(["default",()=>l])}]);