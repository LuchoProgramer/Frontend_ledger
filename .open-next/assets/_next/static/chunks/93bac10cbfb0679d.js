(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,15788,e=>{"use strict";let t=(0,e.i(75254).default)("truck",[["path",{d:"M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2",key:"wrbu53"}],["path",{d:"M15 18H9",key:"1lyqi6"}],["path",{d:"M19 18h2a1 1 0 0 0 1-1v-3.65a1 1 0 0 0-.22-.624l-3.48-4.35A1 1 0 0 0 17.52 8H14",key:"lysw3i"}],["circle",{cx:"17",cy:"18",r:"2",key:"332jqn"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}]]);e.s(["Truck",()=>t],15788)},18566,(e,t,s)=>{t.exports=e.r(76562)},75254,e=>{"use strict";var t=e.i(71645);let s=e=>{let t=e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,s)=>s?s.toUpperCase():t.toLowerCase());return t.charAt(0).toUpperCase()+t.slice(1)},r=(...e)=>e.filter((e,t,s)=>!!e&&""!==e.trim()&&s.indexOf(e)===t).join(" ").trim();var a={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let l=(0,t.forwardRef)(({color:e="currentColor",size:s=24,strokeWidth:l=2,absoluteStrokeWidth:o,className:i="",children:d,iconNode:n,...c},u)=>(0,t.createElement)("svg",{ref:u,...a,width:s,height:s,stroke:e,strokeWidth:o?24*Number(l)/Number(s):l,className:r("lucide",i),...!d&&!(e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0})(c)&&{"aria-hidden":"true"},...c},[...n.map(([e,s])=>(0,t.createElement)(e,s)),...Array.isArray(d)?d:[d]])),o=(e,a)=>{let o=(0,t.forwardRef)(({className:o,...i},d)=>(0,t.createElement)(l,{ref:d,iconNode:a,className:r(`lucide-${s(e).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,`lucide-${e}`,o),...i}));return o.displayName=s(e),o};e.s(["default",()=>o],75254)},7233,e=>{"use strict";let t=(0,e.i(75254).default)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);e.s(["Plus",()=>t],7233)},36786,e=>{"use strict";var t=e.i(18050),s=e.i(71645),r=e.i(74080);function a({children:e,isOpen:a,onClose:l}){let[o,i]=(0,s.useState)(!1);return((0,s.useEffect)(()=>(i(!0),()=>i(!1)),[]),(0,s.useEffect)(()=>(a?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[a]),o&&a)?(0,r.createPortal)((0,t.jsx)("div",{className:"fixed inset-0 z-[99999] overflow-y-auto",role:"dialog","aria-modal":"true",children:(0,t.jsxs)("div",{className:"flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0",children:[(0,t.jsx)("div",{className:"fixed inset-0 transition-opacity bg-gray-900/50 backdrop-blur-sm","aria-hidden":"true",onClick:l}),(0,t.jsx)("span",{className:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true",children:"​"}),(0,t.jsxs)("div",{className:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full relative z-[10000]",onClick:e=>e.stopPropagation(),children:[(0,t.jsx)("div",{className:"absolute top-0 right-0 pt-4 pr-4 block",children:(0,t.jsxs)("button",{type:"button",className:"bg-white rounded-md text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",onClick:l,children:[(0,t.jsx)("span",{className:"sr-only",children:"Cerrar"}),(0,t.jsx)("svg",{className:"h-6 w-6",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","aria-hidden":"true",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})]})}),e]})]})}),document.body):null}e.s(["default",()=>a])},68234,e=>{"use strict";var t=e.i(18050),s=e.i(71645),r=e.i(18566),a=e.i(83639),l=e.i(9165),o=e.i(36786);function i(){let e=(0,r.useRouter)(),i=(0,l.getApiClient)(),[d,n]=(0,s.useState)(new Date().toISOString().split("T")[0]),[c,u]=(0,s.useState)(""),[m,p]=(0,s.useState)(""),[x,h]=(0,s.useState)(null),[b,g]=(0,s.useState)([]),[f,j]=(0,s.useState)([]),[v,y]=(0,s.useState)([]),[N,w]=(0,s.useState)([]),[k,C]=(0,s.useState)(!1),[_,S]=(0,s.useState)(!1),[P,A]=(0,s.useState)(""),[F,E]=(0,s.useState)(!1),[z,R]=(0,s.useState)({nombre:"",ruc:"",direccion:"",telefono:"",email:""}),[$,T]=(0,s.useState)(!1);(0,s.useEffect)(()=>{U(),M(),L()},[]);let L=async()=>{let e=await i.getImpuestos();e.success&&e.data&&w(e.data)},U=async()=>{try{let e=await i.getProveedores({page_size:100});j(e.data||e.results||[])}catch(e){console.error(e)}},M=async(e="")=>{try{let t=await i.getProductos({search:e});y(t.results||[])}catch(e){console.error(e)}},q=(e,t,s)=>{let r=[...b],a=r[e];if("impuesto_id"===t){let e=N.find(e=>e.id===s);e&&(a.impuesto_id=e.id,a.impuesto_porcentaje=parseFloat(e.porcentaje))}else a[t]=s;let l=isNaN(a.cantidad)?0:a.cantidad,o=isNaN(a.precio_unitario)?0:a.precio_unitario;a.subtotal=l*o,a.impuesto_valor=a.subtotal*(a.impuesto_porcentaje/100),g(r)},B=async()=>{if(!x)return void alert("Seleccione un proveedor");if(!c)return void alert("Ingrese el número de factura");if(!m)return void alert("Ingrese el número de autorización");if(0===b.length)return void alert("Agregue al menos un producto");S(!0);try{b.reduce((e,t)=>e+t.subtotal,0);let t=await i.getCurrentUser().catch(()=>({user:null})),s=t?.sucursales?.[0]?.id||1;await i.createCompra({sucursal_id:s,proveedor_id:x,fecha_emision:d,numero_factura:c,numero_autorizacion:m,total_sin_impuestos:O,total_con_impuestos:W,items:b.map(e=>({producto_id:e.producto_id,cantidad:e.cantidad||0,precio_unitario:e.precio_unitario||0,impuesto:e.impuesto_porcentaje}))}),alert("Compra registrada correctamente"),e.push("/compras")}catch(e){alert(e.message||"Error al guardar compra")}finally{S(!1)}},I=async e=>{if(e.preventDefault(),T(!0),13!==z.ruc.length){alert("El RUC debe tener 13 dígitos"),T(!1);return}try{let e=(0,l.getApiClient)(),t=await e.crearProveedor(z);if(t.success){await U();let e=await i.getProveedores({page_size:100}),t=(e.data||e.results||[]).find(e=>e.ruc===z.ruc);t&&(j(e.data||e.results||[]),h(t.id)),E(!1),R({nombre:"",ruc:"",direccion:"",telefono:"",email:""}),alert("Proveedor creado correctamente")}else alert("string"==typeof t.error?t.error:"Error al crear proveedor")}catch(e){console.error(e),alert("Error al crear proveedor")}finally{T(!1)}},O=b.reduce((e,t)=>e+t.subtotal,0),D=b.reduce((e,t)=>e+t.impuesto_valor,0),W=O+D,G=b.filter(e=>15===e.impuesto_porcentaje).reduce((e,t)=>e+t.subtotal,0),H=b.filter(e=>0===e.impuesto_porcentaje).reduce((e,t)=>e+t.subtotal,0),K=b.filter(e=>15!==e.impuesto_porcentaje&&0!==e.impuesto_porcentaje).reduce((e,t)=>e+t.subtotal,0);return(0,t.jsx)(a.default,{children:(0,t.jsxs)("div",{className:"p-6 max-w-5xl mx-auto",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold text-gray-800 mb-6",children:"Registrar Nueva Compra"}),(0,t.jsx)("div",{className:"bg-white rounded-lg shadow-sm p-6 mb-6",children:(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Fecha Emisión"}),(0,t.jsx)("input",{type:"date",className:"w-full p-2 border rounded",value:d,onChange:e=>n(e.target.value)})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Proveedor"}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)("select",{className:"w-full p-2 border rounded",value:x||"",onChange:e=>h(Number(e.target.value)),children:[(0,t.jsx)("option",{value:"",children:"Seleccione..."}),f.map(e=>(0,t.jsxs)("option",{value:e.id,children:[e.nombre," (",e.ruc,")"]},e.id))]}),(0,t.jsx)("button",{onClick:()=>E(!0),className:"bg-blue-600 text-white px-3 rounded hover:bg-blue-700 font-bold",title:"Nuevo Proveedor",children:"+"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nro. Factura"}),(0,t.jsx)("input",{type:"text",className:"w-full p-2 border rounded",placeholder:"001-001-000000123",value:c,onChange:e=>u(e.target.value)})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Autorización *"}),(0,t.jsx)("input",{type:"text",required:!0,className:"w-full p-2 border rounded",value:m,onChange:e=>p(e.target.value)})]})]})}),(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,t.jsxs)("div",{className:"lg:col-span-1 bg-white rounded-lg shadow-sm p-4 h-[500px] flex flex-col",children:[(0,t.jsx)("h2",{className:"font-semibold mb-4",children:"Buscar Productos"}),(0,t.jsx)("input",{type:"text",placeholder:"Buscar...",className:"w-full p-2 border rounded mb-4",onChange:e=>{let t=e.target.value;t.length>2&&M(t)}}),(0,t.jsx)("div",{className:"flex-1 overflow-y-auto space-y-2",children:v.map(e=>(0,t.jsxs)("div",{className:"p-3 border rounded hover:bg-gray-50 cursor-pointer flex justify-between items-center",onClick:()=>(e=>{if(b.find(t=>t.producto_id===e.id))return;let t=N.find(t=>t.id===e.impuesto_id)||N.find(e=>"15.00"===e.porcentaje)||N[0];g([...b,{producto_id:e.id,nombre:e.nombre,cantidad:1,precio_unitario:0,subtotal:0,impuesto_id:t?.id||0,impuesto_porcentaje:t?parseFloat(t.porcentaje):0,impuesto_valor:0}])})(e),children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium text-sm",children:e.nombre}),(0,t.jsx)("p",{className:"text-xs text-gray-500",children:e.codigo_producto||e.id})]}),(0,t.jsx)("span",{className:"text-indigo-600 text-lg font-bold",children:"+"})]},e.id))})]}),(0,t.jsxs)("div",{className:"lg:col-span-2 bg-white rounded-lg shadow-sm p-6",children:[(0,t.jsx)("h2",{className:"font-semibold mb-4",children:"Detalle de Factura"}),(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)("table",{className:"w-full text-sm text-left",children:[(0,t.jsx)("thead",{className:"bg-gray-50 text-gray-700 font-medium",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"p-2",children:"Producto"}),(0,t.jsx)("th",{className:"p-2 w-24",children:"Cant."}),(0,t.jsx)("th",{className:"p-2 w-32",children:"Costo Unit."}),(0,t.jsx)("th",{className:"p-2 w-32",children:"Impuesto"}),(0,t.jsx)("th",{className:"p-2 text-right",children:"Subtotal"}),(0,t.jsx)("th",{className:"p-2 w-10"})]})}),(0,t.jsxs)("tbody",{className:"divide-y",children:[b.map((e,s)=>(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{className:"p-2",children:e.nombre}),(0,t.jsx)("td",{className:"p-2",children:(0,t.jsx)("input",{type:"number",className:"w-full p-1 border rounded text-center",value:isNaN(e.cantidad)?"":e.cantidad,min:"1",onChange:e=>q(s,"cantidad",parseFloat(e.target.value))})}),(0,t.jsx)("td",{className:"p-2",children:(0,t.jsx)("input",{type:"number",className:"w-full p-1 border rounded text-right",value:isNaN(e.precio_unitario)?"":e.precio_unitario,step:"0.01",onChange:e=>q(s,"precio_unitario",parseFloat(e.target.value))})}),(0,t.jsx)("td",{className:"p-2",children:(0,t.jsx)("select",{className:"w-full p-1 border rounded text-sm",value:e.impuesto_id,onChange:e=>q(s,"impuesto_id",Number(e.target.value)),children:N.map(e=>(0,t.jsxs)("option",{value:e.id,children:[e.nombre," (",e.porcentaje,"%)"]},e.id))})}),(0,t.jsxs)("td",{className:"p-2 text-right font-bold",children:["$",e.subtotal.toFixed(2)]}),(0,t.jsx)("td",{className:"p-2 text-center text-red-500 cursor-pointer",onClick:()=>{let e;(e=[...b]).splice(s,1),g(e)},children:"✕"})]},s)),0===b.length&&(0,t.jsx)("tr",{children:(0,t.jsx)("td",{colSpan:6,className:"p-8 text-center text-gray-400",children:"Agregue productos desde el panel izquierdo"})})]})]})}),(0,t.jsxs)("div",{className:"mt-6 border-t pt-4 bg-gray-50 p-4 rounded text-sm",children:[(0,t.jsxs)("div",{className:"flex justify-between mb-1",children:[(0,t.jsx)("span",{children:"Subtotal 15%:"}),(0,t.jsxs)("span",{children:["$",G.toFixed(2)]})]}),(0,t.jsxs)("div",{className:"flex justify-between mb-1",children:[(0,t.jsx)("span",{children:"Subtotal 0%:"}),(0,t.jsxs)("span",{children:["$",H.toFixed(2)]})]}),K>0&&(0,t.jsxs)("div",{className:"flex justify-between mb-1",children:[(0,t.jsx)("span",{children:"Subtotal Otros:"}),(0,t.jsxs)("span",{children:["$",K.toFixed(2)]})]}),(0,t.jsxs)("div",{className:"flex justify-between mb-1 font-semibold text-gray-700",children:[(0,t.jsx)("span",{children:"IVA Total:"}),(0,t.jsxs)("span",{children:["$",D.toFixed(2)]})]}),(0,t.jsxs)("div",{className:"flex justify-between mt-3 text-xl font-bold border-t pt-2",children:[(0,t.jsx)("span",{children:"Total:"}),(0,t.jsxs)("span",{className:"text-indigo-600",children:["$",W.toFixed(2)]})]})]}),(0,t.jsxs)("div",{className:"mt-6 flex justify-end gap-3",children:[(0,t.jsx)("button",{onClick:()=>e.back(),className:"px-4 py-2 border rounded text-gray-600 hover:bg-gray-50",children:"Cancelar"}),(0,t.jsx)("button",{onClick:B,disabled:_,className:"px-6 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700 disabled:opacity-50",children:_?"Guardando...":"Registrar Compra"})]})]})]}),(0,t.jsx)(o.default,{isOpen:F,onClose:()=>E(!1),children:(0,t.jsx)("form",{onSubmit:I,children:(0,t.jsxs)("div",{className:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4 max-w-lg w-full rounded-2xl",children:[(0,t.jsx)("h3",{className:"text-xl font-bold text-gray-900 mb-4",children:"Nuevo Proveedor"}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"RUC *"}),(0,t.jsx)("input",{type:"text",required:!0,maxLength:13,placeholder:"099...",className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",value:z.ruc,onChange:e=>R({...z,ruc:e.target.value})})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Razón Social *"}),(0,t.jsx)("input",{type:"text",required:!0,className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",value:z.nombre,onChange:e=>R({...z,nombre:e.target.value})})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Teléfono"}),(0,t.jsx)("input",{type:"text",className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",value:z.telefono,onChange:e=>R({...z,telefono:e.target.value})})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Email"}),(0,t.jsx)("input",{type:"email",className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",value:z.email,onChange:e=>R({...z,email:e.target.value})})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Dirección"}),(0,t.jsx)("input",{type:"text",className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",value:z.direccion,onChange:e=>R({...z,direccion:e.target.value})})]})]}),(0,t.jsxs)("div",{className:"mt-6 flex justify-end gap-3",children:[(0,t.jsx)("button",{type:"button",onClick:()=>E(!1),className:"px-4 py-2 border rounded text-gray-600 hover:bg-gray-50",children:"Cancelar"}),(0,t.jsx)("button",{type:"submit",disabled:$,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50",children:$?"Guardando...":"Guardar Proveedor"})]})]})})})]})})}e.s(["default",()=>i])}]);