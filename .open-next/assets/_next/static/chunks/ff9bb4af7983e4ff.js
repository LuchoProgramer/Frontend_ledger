(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,15788,e=>{"use strict";let t=(0,e.i(75254).default)("truck",[["path",{d:"M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2",key:"wrbu53"}],["path",{d:"M15 18H9",key:"1lyqi6"}],["path",{d:"M19 18h2a1 1 0 0 0 1-1v-3.65a1 1 0 0 0-.22-.624l-3.48-4.35A1 1 0 0 0 17.52 8H14",key:"lysw3i"}],["circle",{cx:"17",cy:"18",r:"2",key:"332jqn"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}]]);e.s(["Truck",()=>t],15788)},18566,(e,t,a)=>{t.exports=e.r(76562)},75254,e=>{"use strict";var t=e.i(71645);let a=e=>{let t=e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,a)=>a?a.toUpperCase():t.toLowerCase());return t.charAt(0).toUpperCase()+t.slice(1)},r=(...e)=>e.filter((e,t,a)=>!!e&&""!==e.trim()&&a.indexOf(e)===t).join(" ").trim();var s={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let i=(0,t.forwardRef)(({color:e="currentColor",size:a=24,strokeWidth:i=2,absoluteStrokeWidth:l,className:d="",children:c,iconNode:n,...o},u)=>(0,t.createElement)("svg",{ref:u,...s,width:a,height:a,stroke:e,strokeWidth:l?24*Number(i)/Number(a):i,className:r("lucide",d),...!c&&!(e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0})(o)&&{"aria-hidden":"true"},...o},[...n.map(([e,a])=>(0,t.createElement)(e,a)),...Array.isArray(c)?c:[c]])),l=(e,s)=>{let l=(0,t.forwardRef)(({className:l,...d},c)=>(0,t.createElement)(i,{ref:c,iconNode:s,className:r(`lucide-${a(e).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,`lucide-${e}`,l),...d}));return l.displayName=a(e),l};e.s(["default",()=>l],75254)},7233,e=>{"use strict";let t=(0,e.i(75254).default)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);e.s(["Plus",()=>t],7233)},7306,e=>{"use strict";var t=e.i(18050),a=e.i(71645),r=e.i(18566),s=e.i(83639),i=e.i(9165);function l(){let e=(0,r.useRouter)(),l=(0,i.getApiClient)(),[d,c]=(0,a.useState)(""),[n,o]=(0,a.useState)([]),[u,x]=(0,a.useState)(null),[m,h]=(0,a.useState)("Devolución de mercadería"),[p,y]=(0,a.useState)([]),[b,g]=(0,a.useState)(!1),[v,N]=(0,a.useState)(!1),f=async e=>{if(!(e.length<3)){g(!0);try{let t=await l.getHistorialVentas({search:e});o(t.results||[])}catch(e){console.error(e)}finally{g(!1)}}},j=async()=>{if(u){if(0===p.length)return void alert("Seleccione al menos un producto para devolver");if(confirm("¿Está seguro de generar esta Nota de Crédito? Esta acción enviará el documento al SRI.")){N(!0);try{await l.crearNotaCredito({factura_id:u.id,items:p,motivo:m}),alert("Nota de Crédito generada exitosamente"),e.push("/facturacion/notas-credito")}catch(e){alert(e.error||"Error al generar NC")}finally{N(!1)}}}};return(0,t.jsx)(s.default,{children:(0,t.jsxs)("div",{className:"p-6 max-w-4xl mx-auto",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold text-gray-800 mb-6",children:"Nueva Nota de Crédito"}),u?(0,t.jsxs)("div",{className:"bg-white p-6 rounded shadow-sm",children:[(0,t.jsxs)("div",{className:"flex justify-between items-start mb-6 border-b pb-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("h2",{className:"text-lg font-bold",children:["Modificando Factura: ",u.numero_autorizacion]}),(0,t.jsx)("p",{className:"text-gray-600",children:u.cliente_nombre})]}),(0,t.jsx)("button",{onClick:()=>x(null),className:"text-sm text-red-500 hover:underline",children:"Cambiar Factura"})]}),(0,t.jsxs)("div",{className:"mb-6",children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Motivo / Razón"}),(0,t.jsx)("input",{type:"text",className:"w-full p-2 border rounded",value:m,onChange:e=>h(e.target.value)})]}),(0,t.jsx)("h3",{className:"font-medium mb-2",children:"Seleccione Productos a Devolver:"}),(0,t.jsxs)("table",{className:"min-w-full divide-y divide-gray-200 mb-6",children:[(0,t.jsx)("thead",{className:"bg-gray-50",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"px-4 py-2 text-left text-xs text-gray-500",children:"Producto"}),(0,t.jsx)("th",{className:"px-4 py-2 text-center text-xs text-gray-500",children:"Facturado"}),(0,t.jsx)("th",{className:"px-4 py-2 text-center text-xs text-gray-500",children:"A Devolver"})]})}),(0,t.jsx)("tbody",{className:"divide-y divide-gray-200",children:u.detalles?.map(e=>(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{className:"px-4 py-2 text-sm",children:e.product_name}),(0,t.jsx)("td",{className:"px-4 py-2 text-center text-sm",children:e.cantidad}),(0,t.jsx)("td",{className:"px-4 py-2 text-center",children:(0,t.jsx)("input",{type:"number",className:"w-20 p-1 border rounded text-center",min:"0",max:e.cantidad,placeholder:"0",onChange:t=>{((e,t,a)=>{let r=parseFloat(a);if(r<0)return;if(r>t)return alert(`No puede devolver m\xe1s de lo facturado (${t})`);let s=p.filter(t=>t.producto_id!==e);r>0&&s.push({producto_id:e,cantidad:r}),y(s)})(e.producto,e.cantidad,t.target.value)}})})]},e.id))})]}),(0,t.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,t.jsx)("button",{onClick:()=>e.back(),className:"px-4 py-2 border rounded text-gray-600",children:"Cancelar"}),(0,t.jsx)("button",{onClick:j,disabled:v,className:"px-6 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700 disabled:opacity-50",children:v?"Generando...":"Generar Nota de Crédito"})]})]}):(0,t.jsxs)("div",{className:"bg-white p-6 rounded shadow-sm",children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Buscar Factura a Modificar"}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("input",{type:"text",className:"flex-1 p-2 border rounded",placeholder:"Número de autorización, Cédula o Nombre Cliente...",value:d,onChange:e=>c(e.target.value),onKeyDown:e=>"Enter"===e.key&&f(d)}),(0,t.jsx)("button",{onClick:()=>f(d),className:"px-4 py-2 bg-indigo-600 text-white rounded",children:"Buscar"})]}),b&&(0,t.jsx)("div",{className:"mt-4 text-center",children:"Buscando..."}),(0,t.jsx)("div",{className:"mt-4 space-y-2",children:n.map(e=>(0,t.jsxs)("div",{className:"p-4 border rounded hover:bg-gray-50 flex justify-between items-center cursor-pointer",onClick:()=>{x(e),o([]),c(""),e.detalles&&y([])},children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-bold",children:e.numero_autorizacion}),(0,t.jsxs)("div",{className:"text-sm text-gray-600",children:[e.cliente_nombre," - $",e.total_con_impuestos]}),(0,t.jsx)("div",{className:"text-xs text-gray-400",children:new Date(e.fecha_emision).toLocaleString()})]}),(0,t.jsx)("div",{className:"text-indigo-600 font-bold",children:"Seleccionar"})]},e.id))})]})]})})}e.s(["default",()=>l])}]);