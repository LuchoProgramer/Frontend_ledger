(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,18566,(e,s,r)=>{s.exports=e.r(76562)},96692,e=>{"use strict";var s=e.i(18050),r=e.i(71645),a=e.i(18566),t=e.i(9165),l=e.i(57951);function i(){let e=(0,a.useRouter)(),{isAdmin:i}=(0,l.useAuth)(),[o,n]=(0,r.useState)(!1),[d,c]=(0,r.useState)(""),[u,m]=(0,r.useState)(!1),[x,g]=(0,r.useState)({username:"",email:"",password:"",first_name:"",last_name:"",grupos:[],sucursales:[],is_active:!0}),[h,p]=(0,r.useState)([]),[b,j]=(0,r.useState)([]),[y,f]=(0,r.useState)(!0);(0,r.useEffect)(()=>{i||e.push("/")},[i,e]),(0,r.useEffect)(()=>{let e=async()=>{try{let e=(0,t.getApiClient)(),[s,r]=await Promise.all([e.getGrupos(),e.getSucursales()]);s.success&&p(s.grupos),r.success&&(j(r.sucursales),r.sucursales&&0!==r.sucursales.length||c("No hay sucursales registradas. Debe crear al menos una sucursal antes de crear usuarios."))}catch(e){c(e.message||"Error cargando datos")}finally{f(!1)}};i&&e()},[i]);let v=async s=>{if(s.preventDefault(),c(""),m(!1),n(!0),!x.username.trim()){c("El nombre de usuario es requerido"),n(!1);return}if(!x.password||x.password.length<8){c("La contraseña debe tener al menos 8 caracteres"),n(!1);return}try{let s=(0,t.getApiClient)(),r=await s.crearUsuario(x);r.success?(m(!0),setTimeout(()=>{e.push("/usuarios")},1500)):c(r.error||"Error creando usuario")}catch(e){c(e.message||"Error creando usuario")}finally{n(!1)}};return i?(0,s.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,s.jsx)("div",{className:"bg-white shadow-sm border-b",children:(0,s.jsx)("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,s.jsx)("button",{onClick:()=>e.push("/usuarios"),className:"text-gray-600 hover:text-gray-900",children:"← Volver"}),(0,s.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Crear Nuevo Usuario"})]})})}),(0,s.jsxs)("main",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[d&&(0,s.jsx)("div",{className:"mb-6 bg-red-50 border border-red-200 rounded-lg p-4",children:(0,s.jsxs)("div",{className:"flex items-start",children:[(0,s.jsx)("svg",{className:"w-5 h-5 text-red-600 mr-2 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20",children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("p",{className:"text-red-700 font-medium",children:d}),0===b.length&&(0,s.jsxs)("button",{onClick:()=>e.push("/sucursales/nuevo"),className:"mt-3 inline-flex items-center px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:[(0,s.jsx)("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Crear Primera Sucursal"]})]})]})}),u&&(0,s.jsx)("div",{className:"mb-6 bg-green-50 border border-green-200 rounded-lg p-4",children:(0,s.jsx)("p",{className:"text-green-700",children:"✅ Usuario creado exitosamente. Redirigiendo..."})}),y?(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border p-12 text-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto"}),(0,s.jsx)("p",{className:"text-gray-500 mt-4",children:"Cargando formulario..."})]}):0===b.length?(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border p-12 text-center",children:[(0,s.jsx)("svg",{className:"w-16 h-16 text-gray-400 mx-auto mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})}),(0,s.jsx)("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"No hay sucursales registradas"}),(0,s.jsx)("p",{className:"text-gray-600 mb-6",children:"Para crear usuarios, primero debe crear al menos una sucursal donde puedan trabajar."}),(0,s.jsxs)("div",{className:"flex gap-4 justify-center",children:[(0,s.jsxs)("button",{onClick:()=>e.push("/sucursales/nuevo"),className:"inline-flex items-center px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[(0,s.jsx)("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Crear Primera Sucursal"]}),(0,s.jsx)("button",{onClick:()=>e.push("/usuarios"),className:"px-6 py-3 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors",children:"Volver"})]})]}):(0,s.jsxs)("form",{onSubmit:v,className:"bg-white rounded-lg shadow-sm border overflow-hidden",children:[(0,s.jsxs)("div",{className:"p-6 space-y-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Información Básica"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Nombre de Usuario ",(0,s.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,s.jsx)("input",{type:"text",value:x.username,onChange:e=>g({...x,username:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",placeholder:"usuario123",required:!0}),(0,s.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Sin espacios ni caracteres especiales"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Correo Electrónico"}),(0,s.jsx)("input",{type:"email",value:x.email,onChange:e=>g({...x,email:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",placeholder:"usuario@ejemplo.com"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nombre"}),(0,s.jsx)("input",{type:"text",value:x.first_name,onChange:e=>g({...x,first_name:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",placeholder:"Juan"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Apellido"}),(0,s.jsx)("input",{type:"text",value:x.last_name,onChange:e=>g({...x,last_name:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",placeholder:"Pérez"})]}),(0,s.jsxs)("div",{className:"md:col-span-2",children:[(0,s.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Contraseña ",(0,s.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,s.jsx)("input",{type:"password",value:x.password,onChange:e=>g({...x,password:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",placeholder:"••••••••",required:!0,minLength:8}),(0,s.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Mínimo 8 caracteres"})]})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Grupos y Permisos"}),(0,s.jsx)("div",{className:"space-y-2",children:0===h.length?(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"No hay grupos disponibles"}):h.map(e=>(0,s.jsxs)("label",{className:"flex items-center space-x-3 p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer",children:[(0,s.jsx)("input",{type:"checkbox",checked:x.grupos.includes(e.id),onChange:()=>{var s;return s=e.id,void g(e=>({...e,grupos:e.grupos.includes(s)?e.grupos.filter(e=>e!==s):[...e.grupos,s]}))},className:"w-4 h-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"font-medium text-gray-900",children:e.name}),"Administrador"===e.name&&(0,s.jsx)("p",{className:"text-xs text-gray-500",children:"Acceso completo al sistema"}),"Usuarios"===e.name&&(0,s.jsx)("p",{className:"text-xs text-gray-500",children:"Acceso al POS y ventas"})]})]},e.id))})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Sucursales Asignadas"}),(0,s.jsx)("div",{className:"space-y-2",children:0===b.length?(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"No hay sucursales disponibles"}):b.map(e=>(0,s.jsxs)("label",{className:"flex items-center space-x-3 p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer",children:[(0,s.jsx)("input",{type:"checkbox",checked:x.sucursales.includes(e.id),onChange:()=>{var s;return s=e.id,void g(e=>({...e,sucursales:e.sucursales.includes(s)?e.sucursales.filter(e=>e!==s):[...e.sucursales,s]}))},className:"w-4 h-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)("span",{className:"font-medium text-gray-900",children:e.nombre}),e.es_matriz&&(0,s.jsx)("span",{className:"text-xs bg-blue-100 text-blue-800 px-2 py-0.5 rounded",children:"Matriz"})]}),e.codigo_establecimiento&&(0,s.jsxs)("p",{className:"text-xs text-gray-500",children:["Cód: ",e.codigo_establecimiento]})]})]},e.id))})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Estado"}),(0,s.jsxs)("label",{className:"flex items-center space-x-3 p-3 border border-gray-200 rounded-lg cursor-pointer",children:[(0,s.jsx)("input",{type:"checkbox",checked:x.is_active,onChange:e=>g({...x,is_active:e.target.checked}),className:"w-4 h-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"font-medium text-gray-900",children:"Usuario Activo"}),(0,s.jsx)("p",{className:"text-xs text-gray-500",children:"Permitir acceso al sistema"})]})]})]})]}),(0,s.jsxs)("div",{className:"bg-gray-50 px-6 py-4 flex justify-end space-x-4",children:[(0,s.jsx)("button",{type:"button",onClick:()=>e.push("/usuarios"),className:"px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-100 font-medium",disabled:o,children:"Cancelar"}),(0,s.jsx)("button",{type:"submit",disabled:o,className:"px-6 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg font-medium disabled:bg-gray-400 disabled:cursor-not-allowed",children:o?"Creando...":"Crear Usuario"})]})]})]})]}):null}e.s(["default",()=>i])}]);