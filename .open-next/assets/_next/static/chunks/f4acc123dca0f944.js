(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,15788,e=>{"use strict";let t=(0,e.i(75254).default)("truck",[["path",{d:"M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2",key:"wrbu53"}],["path",{d:"M15 18H9",key:"1lyqi6"}],["path",{d:"M19 18h2a1 1 0 0 0 1-1v-3.65a1 1 0 0 0-.22-.624l-3.48-4.35A1 1 0 0 0 17.52 8H14",key:"lysw3i"}],["circle",{cx:"17",cy:"18",r:"2",key:"332jqn"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}]]);e.s(["Truck",()=>t],15788)},18566,(e,t,r)=>{t.exports=e.r(76562)},75254,e=>{"use strict";var t=e.i(71645);let r=e=>{let t=e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,r)=>r?r.toUpperCase():t.toLowerCase());return t.charAt(0).toUpperCase()+t.slice(1)},a=(...e)=>e.filter((e,t,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim();var i={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let s=(0,t.forwardRef)(({color:e="currentColor",size:r=24,strokeWidth:s=2,absoluteStrokeWidth:o,className:c="",children:l,iconNode:d,...n},u)=>(0,t.createElement)("svg",{ref:u,...i,width:r,height:r,stroke:e,strokeWidth:o?24*Number(s)/Number(r):s,className:a("lucide",c),...!l&&!(e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0})(n)&&{"aria-hidden":"true"},...n},[...d.map(([e,r])=>(0,t.createElement)(e,r)),...Array.isArray(l)?l:[l]])),o=(e,i)=>{let o=(0,t.forwardRef)(({className:o,...c},l)=>(0,t.createElement)(s,{ref:l,iconNode:i,className:a(`lucide-${r(e).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,`lucide-${e}`,o),...c}));return o.displayName=r(e),o};e.s(["default",()=>o],75254)},7233,e=>{"use strict";let t=(0,e.i(75254).default)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);e.s(["Plus",()=>t],7233)},85031,e=>{"use strict";var t=e.i(18050),r=e.i(71645),a=e.i(18566),i=e.i(83639),s=e.i(9165);function o(e){let o=(0,r.use)(e.params).id,[c,l]=(0,r.useState)(null),[d,n]=(0,r.useState)([]),[u,x]=(0,r.useState)(!0),[p,m]=(0,r.useState)(""),[h,g]=(0,r.useState)(!1),f=(0,a.useRouter)(),y=(0,s.getApiClient)();(0,r.useEffect)(()=>{w()},[o]);let w=async()=>{x(!0);try{let e=await y.getAuditoria(Number(o));if(!e)throw Error("No data");l(e);let t=(e.detalles||[]).map(e=>({id:e.id,producto_id:e.producto,codigo:e.producto_codigo||"N/A",nombre:e.producto_nombre||"Producto",categoria:e.categoria_nombre||"General",stock_sistema:e.cantidad_sistema,conteo_fisico:e.cantidad_fisica,diferencia:e.diferencia}));n(t)}catch(e){console.error(e),alert("Error al cargar auditoría")}finally{x(!1)}},b=async()=>{g(!0);try{let e=d.filter(e=>null!==e.conteo_fisico&&void 0!==e.conteo_fisico).map(e=>({id:e.id,cantidad_fisica:e.conteo_fisico}));e.length>0&&(await y.updateAuditoriaCount(Number(o),e),await w()),alert("Avance guardado.")}catch(e){console.error(e),alert("Error al guardar")}finally{g(!1)}},N=async()=>{if(confirm("¿Estás seguro de finalizar la auditoría? Esto cerrará el conteo y generará el reporte final."))try{await b(),await y.finalizeAuditoria(Number(o)),alert("Auditoría finalizada correctamente."),f.push("/inventario/auditoria")}catch(e){alert(e.error||"Error al finalizar")}},j=d.filter(e=>e.nombre.toLowerCase().includes(p.toLowerCase())||e.codigo.toLowerCase().includes(p.toLowerCase()));if(u)return(0,t.jsx)(i.default,{children:(0,t.jsx)("div",{className:"p-8 text-center",children:"Cargando..."})});if(!c)return(0,t.jsx)(i.default,{children:(0,t.jsx)("div",{className:"p-8 text-center",children:"Auditoría no encontrada"})});let v="BORRADOR"===c.estado;return(0,t.jsx)(i.default,{children:(0,t.jsxs)("div",{className:"p-6",children:[(0,t.jsxs)("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)("h1",{className:"text-2xl font-bold text-gray-800",children:["Auditoría #",c.id]}),(0,t.jsx)("span",{className:`px-2 py-1 text-xs rounded-full font-bold ${v?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"}`,children:c.estado})]}),(0,t.jsxs)("p",{className:"text-gray-500 text-sm mt-1",children:["Sucursal: ",c.sucursal," | Inicio: ",new Date(c.fecha_inicio).toLocaleString()]})]}),v&&(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("button",{onClick:b,disabled:h,className:"px-4 py-2 border border-gray-300 bg-white rounded text-gray-700 hover:bg-gray-50 disabled:opacity-50",children:h?"Guardando...":"Guardar Avance"}),(0,t.jsx)("button",{onClick:N,className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 shadow-sm",children:"Finalizar Auditoría"})]})]}),(0,t.jsx)("div",{className:"mb-4",children:(0,t.jsx)("input",{type:"text",placeholder:"Buscar producto por nombre o código...",className:"w-full p-2 border rounded shadow-sm",value:p,onChange:e=>m(e.target.value)})}),(0,t.jsx)("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:(0,t.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,t.jsx)("thead",{className:"bg-gray-50",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Código"}),(0,t.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Producto"}),(0,t.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Categoría"}),(0,t.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider w-32",children:"Stock Sistema"}),(0,t.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider w-32",children:"Conteo Físico"}),(0,t.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider w-32",children:"Diferencia"})]})}),(0,t.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:j.map(e=>(0,t.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,t.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 font-mono",children:e.codigo}),(0,t.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:e.nombre}),(0,t.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.categoria}),(0,t.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-600 text-right",children:Number(e.stock_sistema).toFixed(2)}),(0,t.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:v?(0,t.jsx)("input",{type:"number",className:`w-24 p-1 border rounded text-right focus:ring-2 focus:ring-indigo-500 ${null!==e.conteo_fisico&&void 0!==e.conteo_fisico?"bg-blue-50 border-blue-300":"bg-white"}`,value:null===e.conteo_fisico||void 0===e.conteo_fisico?"":e.conteo_fisico,onChange:t=>{var r,a;return r=e.id,a=t.target.value,void n(d.map(e=>{if(e.id===r){let t=""===a?null:parseFloat(a),r=null!==t?t-e.stock_sistema:null;return{...e,conteo_fisico:t,diferencia:r,modificado:!0}}return e}))},placeholder:"0.00"}):(0,t.jsx)("span",{className:"text-sm font-bold",children:null!==e.conteo_fisico?Number(e.conteo_fisico).toFixed(2):"-"})}),(0,t.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right font-bold",children:null!==e.conteo_fisico?(0,t.jsxs)("span",{className:0>(e.diferencia||0)?"text-red-600":(e.diferencia||0)>0?"text-green-600":"text-gray-400",children:[(e.diferencia||0)>0?"+":"",Number(e.diferencia||0).toFixed(2)]}):(0,t.jsx)("span",{className:"text-gray-300",children:"-"})})]},e.id))})]})})]})})}e.s(["default",()=>o])}]);